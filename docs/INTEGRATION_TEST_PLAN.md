# 전체 시스템 통합 테스트 계획

## 🎯 테스트 목표
프론트엔드 + 백엔드 + 데이터베이스 + LS증권 API 연동 전체 플로우 검증

---

## 📋 테스트 환경 준비

### 1. 필수 서비스 체크리스트
- [ ] PostgreSQL 실행 중
- [ ] Redis 실행 중 (선택)
- [ ] LS증권 API 계정 설정 완료
- [ ] 환경 변수 설정 완료

### 2. 데이터베이스 초기화
```bash
# PostgreSQL 테이블 생성
psql -U postgres -d hts_db -f scripts/init_postgres_tables.sql

# 종목 마스터 업데이트
python scripts/update_stock_master.py
```

### 3. 데이터 수집 (선택)
```bash
# 시장 데이터 수집 (200종목, 180일)
python scripts/fetch_ohlc_data.py --count 200 --days 180
```

---

## 🧪 테스트 시나리오

### Phase 1: 백엔드 단독 테스트

#### 1.1 서버 시작
```bash
# Terminal 1: 백엔드 서버
python -m uvicorn api.main:app --reload --port 8000
```

**예상 결과**:
```
INFO:     Uvicorn running on http://127.0.0.1:8000
INFO:     Application startup complete.
```

#### 1.2 Health Check
```bash
curl http://localhost:8000/health
```

**예상 응답**:
```json
{
  "status": "healthy",
  "database": "connected",
  "timestamp": "2025-11-30T..."
}
```

#### 1.3 API 문서 확인
- 브라우저: http://localhost:8000/docs
- 확인 사항:
  - [ ] Swagger UI 로딩
  - [ ] 모든 엔드포인트 표시
  - [ ] 스키마 정의 확인

---

### Phase 2: 프론트엔드 단독 테스트

#### 2.1 개발 서버 시작
```bash
# Terminal 2: 프론트엔드 서버
cd frontend
npm run dev
```

**예상 결과**:
```
VITE v6.0.5  ready in 500 ms
➜  Local:   http://localhost:3000/
➜  Network: use --host to expose
```

#### 2.2 페이지 로딩 확인
- 브라우저: http://localhost:3000
- 확인 사항:
  - [ ] 로그인 페이지 표시
  - [ ] CSS 스타일 적용
  - [ ] 콘솔 에러 없음

---

### Phase 3: 인증 플로우 테스트

#### 3.1 회원가입 (API)
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "test1234",
    "email": "test@example.com"
  }'
```

**예상 응답**:
```json
{
  "user_id": 1,
  "username": "testuser",
  "email": "test@example.com"
}
```

#### 3.2 로그인 (프론트엔드)
1. http://localhost:3000/login 접속
2. 입력:
   - 사용자명: `testuser`
   - 비밀번호: `test1234`
3. "로그인" 버튼 클릭

**예상 결과**:
- [ ] 대시보드로 리다이렉트
- [ ] localStorage에 토큰 저장
- [ ] 네비게이션 메뉴 표시

#### 3.3 토큰 검증
```javascript
// 브라우저 콘솔
localStorage.getItem('access_token')
// 토큰 문자열 반환되어야 함
```

---

### Phase 4: 계좌 관리 테스트

#### 4.1 계좌 등록 (프론트엔드)
1. 설정 페이지 이동: http://localhost:3000/settings
2. "계좌 관리" 탭 선택
3. "+ 계좌 추가" 클릭
4. 입력:
   - 계좌번호: `12345678`
   - 계좌 비밀번호: `0000`
   - 인증서 비밀번호: `cert1234`
   - 별칭: `테스트 계좌`
5. "저장" 클릭

**예상 결과**:
- [ ] 계좌 카드 표시
- [ ] "연결 테스트" 버튼 활성화

#### 4.2 계좌 연결 테스트
1. "연결 테스트" 버튼 클릭

**예상 결과** (LS API 연동 시):
- [ ] "연결 성공" 메시지
- [ ] 계좌 잔고 표시

**예상 결과** (Mock 모드):
- [ ] Mock 데이터 표시
- [ ] 에러 없음

---

### Phase 5: 데이터 수집 테스트

#### 5.1 데이터 수집 페이지 접속
- URL: http://localhost:3000/data-collection

**확인 사항**:
- [ ] 통계 카드 표시 (종목 수, OHLC 데이터 수)
- [ ] 수집 설정 폼 표시
- [ ] 종목 목록 테이블 표시

#### 5.2 데이터 수집 시작
1. 수집 종목 수: `50`
2. 수집 기간: `90`일
3. "▶ 수집 시작" 클릭

**예상 결과**:
- [ ] 진행 바 표시
- [ ] 로그 실시간 업데이트
- [ ] 진행률 표시 (0/50 → 50/50)

**예상 소요 시간**: 5-10분 (50종목 기준)

#### 5.3 수집 완료 확인
- [ ] "수집 완료" 로그 표시
- [ ] 통계 업데이트
- [ ] 종목 목록 새로고침

---

### Phase 6: 백테스트 테스트

#### 6.1 백테스트 페이지 접속
- URL: http://localhost:3000/backtest

**확인 사항**:
- [ ] 전략 목록 로딩
- [ ] 폼 요소 표시

#### 6.2 백테스트 실행
1. 전략 선택: `MovingAverageCrossStrategy`
2. 종목 코드: `005930` (삼성전자)
3. 시작일: `2025-08-14`
4. 종료일: `2025-11-22`
5. 초기 자본금: `10000000`
6. "백테스트 실행" 클릭

**예상 결과**:
- [ ] "백테스트 실행 중..." 표시
- [ ] 결과 카드 표시:
  - 총 수익률
  - 최종 자산
  - MDD
  - 샤프 비율
  - 승률
  - 총 거래 수

**예상 소요 시간**: 5-10초

#### 6.3 결과 검증
```bash
# 백엔드 로그 확인
# Terminal 1에서 백테스트 실행 로그 확인
```

---

### Phase 7: 전략 빌더 테스트

#### 7.1 전략 빌더 페이지 접속
- URL: http://localhost:3000/strategy-builder

**확인 사항**:
- [ ] 5개 탭 표시 (종목 선정, 매수 조건, 진입 전략, 매도 조건, 포지션 관리)
- [ ] 폼 요소 정상 작동

#### 7.2 간단한 전략 생성
1. **전략 정보**:
   - 이름: `테스트 전략`
   - 설명: `통합 테스트용 전략`

2. **종목 선정** 탭:
   - 시가총액 최소: `1000` (억원)
   - 거래대금 최소: `1000` (백만원)
   - 관리종목 제외: ✅

3. **매수 조건** 탭:
   - "+ 매수 조건 추가" 클릭
   - 지표: `이동평균선 (MA)`
   - 기간: `20`
   - 연산자: `>`
   - 값: `MA(50)`

4. **진입 전략** 탭:
   - 진입 방식: `일괄 진입`

5. **매도 조건** 탭:
   - "+ 매도 조건 추가" 클릭
   - 지표: `이동평균선 (MA)`
   - 기간: `20`
   - 연산자: `<`
   - 값: `MA(50)`

6. **포지션 관리** 탭:
   - 포지션 사이징: `고정 비율`
   - 포지션 크기: `10%`
   - 최대 포지션 수: `5`
   - 손절: 활성화, 고정 `5%`
   - 익절: 활성화, 고정 `10%`

7. "💾 전략 저장" 클릭

**예상 결과**:
- [ ] "전략이 저장되었습니다!" 알림
- [ ] 백테스트 실행 여부 확인 다이얼로그

#### 7.3 저장된 전략 확인
1. "내 전략" 페이지 이동: http://localhost:3000/strategies
2. 확인:
   - [ ] "테스트 전략" 카드 표시
   - [ ] 수정, 백테스트, 삭제 버튼 표시

---

### Phase 8: 실시간 트레이딩 테스트 (선택)

#### 8.1 대시보드 접속
- URL: http://localhost:3000/dashboard

**확인 사항**:
- [ ] 계좌 선택 드롭다운
- [ ] 계좌 정보 표시
- [ ] 차트 영역 표시
- [ ] 주문 패널 표시
- [ ] 주문 내역 테이블 표시

#### 8.2 차트 로딩
1. 종목 코드 입력: `005930`
2. 인터벌 선택: `1d`

**예상 결과**:
- [ ] 캔들스틱 차트 표시
- [ ] 차트 인터랙션 작동 (줌, 팬)

#### 8.3 주문 테스트 (Mock 모드)
1. 주문 유형: `지정가`
2. 매수/매도: `매수`
3. 수량: `10`
4. 가격: `70000`
5. "주문 제출" 클릭

**예상 결과** (Mock 모드):
- [ ] 주문 접수 메시지
- [ ] 주문 내역에 추가

---

## 🔍 성능 테스트

### 1. 페이지 로딩 시간
- [ ] 로그인 페이지: < 1초
- [ ] 대시보드: < 2초
- [ ] 백테스트 페이지: < 1.5초
- [ ] 전략 빌더: < 2초

### 2. API 응답 시간
- [ ] 로그인: < 500ms
- [ ] 계좌 조회: < 300ms
- [ ] 백테스트 실행: < 10초
- [ ] 데이터 수집 (1종목): < 5초

### 3. 메모리 사용량
```bash
# 백엔드 메모리 확인
ps aux | grep uvicorn

# 프론트엔드 메모리 (브라우저 개발자 도구)
# Performance > Memory
```

**예상 범위**:
- 백엔드: < 500MB
- 프론트엔드: < 200MB

---

## 🐛 에러 처리 테스트

### 1. 네트워크 에러
- [ ] 백엔드 중단 시 프론트엔드 에러 메시지 표시
- [ ] 재연결 시도

### 2. 인증 에러
- [ ] 잘못된 비밀번호: 에러 메시지 표시
- [ ] 토큰 만료: 로그인 페이지로 리다이렉트

### 3. 데이터 에러
- [ ] 존재하지 않는 종목: 에러 메시지
- [ ] 데이터 없음: 빈 상태 표시

### 4. 입력 검증
- [ ] 필수 필드 누락: 에러 표시
- [ ] 잘못된 형식: 에러 표시

---

## 📊 테스트 결과 기록

### 체크리스트

#### Phase 1: 백엔드 단독
- [ ] 서버 시작 성공
- [ ] Health check 통과
- [ ] API 문서 접근 가능

#### Phase 2: 프론트엔드 단독
- [ ] 개발 서버 시작 성공
- [ ] 페이지 로딩 성공
- [ ] 콘솔 에러 없음

#### Phase 3: 인증
- [ ] 회원가입 성공
- [ ] 로그인 성공
- [ ] 토큰 저장 확인

#### Phase 4: 계좌 관리
- [ ] 계좌 등록 성공
- [ ] 계좌 연결 테스트 성공

#### Phase 5: 데이터 수집
- [ ] 페이지 로딩 성공
- [ ] 데이터 수집 실행 성공
- [ ] 수집 완료 확인

#### Phase 6: 백테스트
- [ ] 페이지 로딩 성공
- [ ] 백테스트 실행 성공
- [ ] 결과 표시 확인

#### Phase 7: 전략 빌더
- [ ] 페이지 로딩 성공
- [ ] 전략 생성 성공
- [ ] 전략 저장 확인

#### Phase 8: 실시간 트레이딩
- [ ] 대시보드 로딩 성공
- [ ] 차트 표시 성공
- [ ] 주문 테스트 성공

---

## 🚨 발견된 이슈

### Critical
- [ ] 없음

### Major
- [ ] 없음

### Minor
- [ ] 없음

---

## ✅ 최종 평가

### 통합 테스트 결과
- [ ] 모든 Phase 통과
- [ ] 성능 기준 충족
- [ ] 에러 처리 적절

### 배포 준비도
- [ ] 프로덕션 배포 가능
- [ ] 스테이징 환경 필요
- [ ] 추가 개선 필요

---

## 📝 다음 단계

### 즉시
1. [ ] 통합 테스트 실행
2. [ ] 이슈 수정
3. [ ] 재테스트

### 단기 (1주)
1. [ ] 스테이징 환경 구축
2. [ ] 부하 테스트
3. [ ] 보안 테스트

### 장기 (1개월)
1. [ ] 프로덕션 배포
2. [ ] 모니터링 설정
3. [ ] 사용자 피드백 수집
