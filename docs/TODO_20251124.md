# 작업 계획 - 2025년 11월 24일

## 어제(11/23) 완료된 작업

### ✅ 인프라 구축
- Docker Desktop + WSL2 설치 완료
- PostgreSQL 15 + Redis 컨테이너 실행 중
- pg8000 드라이버로 교체 (psycopg2 인코딩 문제 해결)

### ✅ 코드 수정
- SQLAlchemy Enum → String 타입 변경
- 전역 예외 핸들러 추가 (api/main.py)
- PostgreSQL 테이블 스키마 수정 (user_id 추가)

### ⚠️ 미해결 문제
- **계좌 API 500 에러**: `/api/accounts` 엔드포인트 에러 발생
- **PostgreSQL 미사용**: 현재 SQLite로 임시 전환된 상태

---

## 오늘 할 일

### 🔴 우선순위 1: 계좌 API 에러 해결
1. 프론트엔드에서 계좌 저장 시도
2. 백엔드 터미널에서 에러 로그 확인 (전역 예외 핸들러 추가됨)
3. 에러 원인 파악 및 수정
4. 계좌 CRUD 기능 전체 테스트

**예상 원인:**
- TradingAccount 모델과 DB 스키마 불일치
- Pydantic 모델 검증 실패
- 암호화 키 문제

### 🟡 우선순위 2: PostgreSQL 마이그레이션
1. `config.yaml`에서 `type: "postgresql"` 활성화
2. 서버 재시작 후 연결 테스트
3. 계좌 API가 PostgreSQL에서 정상 작동하는지 확인
4. 문제 발생 시 에러 로그 확인 및 수정

**체크리스트:**
```yaml
database:
  type: "postgresql"  # sqlite → postgresql 변경
  host: "localhost"
  port: 5432
  database: "hts"
  user: "hts_user"
  password: "hts_password_2024"
```

### 🟢 우선순위 3: 시스템 안정화
1. 모든 API 엔드포인트 테스트
   - `/api/auth/login`
   - `/api/accounts` (GET, POST, PUT, DELETE)
   - `/api/orders`
   - `/api/backtest`
2. 프론트엔드 연동 확인
3. 에러 핸들링 점검

---

## 참고 정보

### Docker 명령어
```bash
# 컨테이너 상태 확인
docker-compose ps

# PostgreSQL 접속
docker exec -it hts-postgres psql -U hts_user -d hts

# 테이블 확인
docker exec -it hts-postgres psql -U hts_user -d hts -c "\d trading_accounts"

# 컨테이너 재시작
docker-compose restart
```

### 디버깅 팁
- 백엔드 로그: PowerShell 터미널에서 `python api/main.py` 실행 창 확인
- 전역 예외 핸들러가 추가되어 모든 에러가 로그에 출력됨
- 에러 발생 시 `Traceback` 또는 `ERROR` 키워드로 검색

### 파일 위치
- 설정: `config.yaml`
- 계좌 모델: `data/account_models.py`
- 계좌 API: `api/routes/accounts.py`
- 계좌 Repository: `api/repositories/account_repository.py`
- PostgreSQL 스키마: `scripts/init_postgres_tables.sql`

---

## 예상 소요 시간
- 계좌 API 에러 해결: 1-2시간
- PostgreSQL 마이그레이션: 30분
- 시스템 안정화: 1시간

**총 예상 시간: 2.5-3.5시간**
